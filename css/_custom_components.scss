// _custom_components.scss

// Define a palette of dull pastel colors for various callout types.
$pastel-primary: #a1b8c3; // Soft Blue-Gray
$pastel-success: #a0c497; // Soft Sage Green
$pastel-warning: #e0b686; // Soft Muted Gold
$pastel-info: #a3c4f3;    // Soft Light Blue
$pastel-danger: #e09f9f;  // Soft Dusty Rose

// The core mixin for all professional callouts
@mixin callout-mk($color) {
    // 1. Core Visuals (Consistency with site's Card Structure)
    @extend .card;
    @extend .shadow-sm;
    @extend .border-0;

    // 2. Pastel Toning and Readability
    background-color: lighten($color, 45%);
    border-left: 0.25rem solid darken($color, 10%);
    color: darken($color, 25%); // Default text color is dark
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;

    // Ensure the content inside is readable against the light background
    h5, h6, p, small {
        color: inherit; // Inherit the darkened text color
    }

    // 3. âœ¨ Crucial Fix: High-Contrast Links and Buttons
    // This ensures URLs are readable against the light background,
    // especially on hover or when they inherit a light color.
    a {
        color: darken($color, 35%); // A darker, high-contrast link color

        &:hover,
        &:focus {
            // Further darken the link on hover for better visibility
            color: darken($color, 45%);
        }
    }

    // Overrides for Bootstrap Buttons within the callout
    .btn-primary {
        // Keeps the primary button style standard, but ensures
        // the text remains highly visible if the button background is light.
        // NOTE: Standard Bootstrap buttons should already have white text,
        // but this ensures consistency if custom buttons are used.
        color: #fff;
    }
}

// Custom Callout Classes (Use the mixin)
.callout-mk-note {
    @include callout-mk($pastel-primary);
}

.callout-mk-tip {
    @include callout-mk($pastel-success);
}

.callout-mk-warning {
    @include callout-mk($pastel-warning);
}

.callout-mk-info {
    @include callout-mk($pastel-info);
}

.callout-mk-alert {
    @include callout-mk($pastel-danger);
}

/* --- NEW STYLES FOR PROGRESSION --- */
  .progression-timeline {
    border-left: 2px solid #ccc;
    padding-left: 1rem;
    position: relative;
    margin-top: 1rem;
  }
  .progression-step {
    margin-bottom: 1.5rem;
    position: relative;
  }
  .progression-step::before {
    content: '';
    position: absolute;
    left: -1.05rem; /* Align with the timeline bar */
    top: 0.2rem;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background-color: #007bff; /* Default OPEN */
    border: 3px solid #fff;
  }
  .step-open::before {
    background-color: #007bff; /* Blue for Open */
  }
  .step-adjustment::before {
    background-color: #ffc107; /* Yellow for Adjustment */
  }
  .step-close::before {
    background-color: #28a745; /* Green for Close */
  }
  .progression-date {
    font-size: 0.75rem;
    color: #6c757d;
    display: block;
    margin-bottom: 0.25rem;
  }

  /* --- NEW & IMPROVED PROGRESSION STYLES --- */
  .trade-progression-container {
    margin-top: 1.5rem;
  }

  .progression-timeline {
    position: relative;
    padding-left: 30px; /* Space for the line and dots */
    list-style: none; /* Remove default list-style */
    margin-top: 1rem;
  }

  .progression-timeline::before {
    content: '';
    position: absolute;
    top: 5px;
    bottom: 5px;
    left: 10px;
    width: 2px;
    background-color: #e9ecef; /* Light grey timeline */
    z-index: 0;
  }

  .progression-step {
    position: relative;
    margin-bottom: 1.25rem;
    padding: 0.75rem 1rem;
    background-color: #fff;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
  }

  /* The dot on the timeline */
  .progression-step::before {
    content: '';
    position: absolute;
    left: -24px; /* (30px padding - (16px width / 2) - 2px border) */
    top: 12px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background-color: #fff;
    border: 3px solid #007bff; /* Default OPEN */
    z-index: 1;
  }

  .step-open::before   { border-color: #0d6efd; } /* Blue */
  .step-adjustment::before { border-color: #ffc107; } /* Yellow */
  .step-close::before  { border-color: #198754; } /* Green */

  .progression-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .progression-date {
    font-size: 0.8rem;
    color: #6c757d;
    font-weight: 500;
  }

  /* The new professional "tags" */
  .progression-tag {
    display: inline-block;
    padding: 0.25em 0.6em;
    font-size: 0.75rem;
    font-weight: 700;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 0.375rem;
  }

  .tag-open {
    color: #052c65;
    background-color: #cfe2ff;
    border: 1px solid #b6d4fe;
  }

  .tag-adjustment {
    color: #664d03;
    background-color: #fff3cd;
    border: 1px solid #ffecb5;
  }

  .tag-close {
    color: #0a3622;
    background-color: #d1e7dd;
    border: 1px solid #c3e6cb;
  }

  .progression-details p {
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
  }

  .progression-details .profit-loss {
    font-weight: bold;
    font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
  }

.leg-details {
    margin-top: 0.5rem;
    padding-left: 0.5rem;
    border-left: 2px solid #007bff;
  }

  /* --- NEW STATUS PILL STYLES --- */
  .trade-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .status-pill {
    display: inline-block;
    padding: 0.3em 0.75em;
    font-size: 0.75rem;
    font-weight: 700;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 50rem; /* pill shape */
    text-transform: uppercase;
    flex-shrink: 0; /* Don't let it wrap */
  }

  .status-open {
    color: #0a3622;
    background-color: #d1e7dd;
    border: 1px solid #c3e6cb;
  }

  .status-closed {
    color: #495057;
    background-color: #e9ecef;
    border: 1px solid #dee2e6;
  }

.leg-grid {
    display: grid;
    /* This will create a 2 or 4 col grid based on available space */
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 0.5rem;
    margin-top: 0.75rem;
  }
  .leg-item {
    padding: 0.25rem 0.5rem;
    background-color: #fff;
    border-radius: 0.25rem;
    border: 1px solid #e9ecef;
    text-align: center;
    font-size: 0.8rem;
  }
  .leg-item strong {
    display: block;
    color: #6c757d;
    font-size: 0.75rem;
    text-transform: uppercase;
  }
  .leg-item span {
    font-size: 0.9rem;
    font-weight: bold;
    font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
  }

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.5rem;
    font-size: 0.8rem;
  }
  .metric-item {
    padding: 0.25rem 0.5rem;
    background-color: #fff;
    border-radius: 0.25rem;
    border: 1px solid #e9ecef;
  }
  .metric-item strong {
    display: block;
    color: #6c757d;
    font-size: 0.75rem;
  }

  /* --- New Status Pill Styling --- */
  .progression-tag {
      /* Base pill styling */
      display: inline-block;
      padding: 0.25em 0.6em;
      font-size: 0.75rem;
      font-weight: 700;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.35rem;
      color: #333; /* Darker text for pastel backgrounds */
      margin-right: 0.5rem;
  }

  /* Pastel Colors for Executed Steps */
  .tag-assignment {
      background-color: #FFF8E1; /* Light Pastel Yellow */
      border: 1px solid #FFE0B2;
  }
  .tag-wheel_step-sell_covered_call {
      background-color: #E8F5E9; /* Light Pastel Green */
      border: 1px solid #C8E6C9;
  }
  .tag-called_away {
      background-color: #FCE4EC; /* Light Pastel Pink */
      border: 1px solid #F8BBD0;
  }
  .tag-open_short_put, .tag-close, .tag-closed_independent_put, .tag-adjustment {
      background-color: #E3F2FD; /* Light Pastel Blue for generic steps */
      border: 1px solid #90CAF9;
  }

  /* --- Estimated Scenario Styling --- */
  .progression-step.estimated-scenario {
      /* Distinct background and border for the LI element */
      background-color: #F3E5F5; /* Light Pastel Violet */
      border: 1px dashed #CE93D8;
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      list-style: none; /* Remove timeline bullet for this step */
  }
  .estimated-scenario .progression-tag {
      background-color: #CE93D8; /* Slightly darker violet pill */
      color: #fff;
      border: none;
  }