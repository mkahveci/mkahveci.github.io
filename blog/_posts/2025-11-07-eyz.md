---
layout: post
author: Murat Kahveci
title: "Trading with Confluence: A 3-Factor Strategy for Intraday Traders"
tags:
  - tools
  - thinkscript
  - qma
related_project:
  name: "Quantitative Market Analysis (qma)"
  url: /qma/
excerpt: A quantitative approach to filter market noise using a three-factor momentum confluence.
mermaid: true
---

## Introduction

In intraday trading, "noise" from single, conflicting indicators often leads to false signals and losing trades. The **Momentum Confluence Strategy** is a technical analysis approach designed to filter this noise by requiring three distinct, non-correlated factors to align before signaling an entry.

### 1. The Philosophy: Why Confluence is Key

In the world of intraday trading, whether in futures or stocks, the single biggest challenge is "noise." How many times have you entered a trade based on one indicator, only to have the market immediately reverse? This happens because a single indicator, like an RSI cross, only tells you one piece of the story.

The "Momentum Confluence Strategy" is built on a simple philosophy: **High-probability trades occur when multiple, non-correlated indicators all agree at the same time.**

Instead of relying on one signal, we wait for a "confluence" of three distinct factors to align. This script is not a "holy grail," but a powerful filter. It visually confirms when:

1.  **Trend/Momentum** is on your side.
2.  **Strength** is backing the move.
3.  **Price Speed** is in agreement.

When all three align, the bar turns a solid color. When they disagree, the bar turns gray, signaling "do nothing." This strategy is designed to keep you *out* of choppy, uncertain markets and only engage when momentum is clear.

### 2. The Three Factors

Our **thinkScript study** for the **ThinkOrSwim (TOS) platform** combines three classic oscillators to measure the pure momentum of the market. This makes it ideal for timing entries on lower timeframes (like 5-min or 15-min charts).

1.  **MACD (12, 26, 9): The "Intermediate Momentum"**
    * **What it is:** The Moving Average Convergence Divergence measures the relationship between a fast and slow exponential moving average (EMA).
    * **The Signal:** We check if the `MACD Line` (`Value` in thinkScript) is above or below its `Signal Line` (`Avg`). When the MACD line is above the signal line, it confirms that intermediate-term momentum is bullish.

2.  **RSI (14): The "Momentum Strength"**
    * **What it is:** The Relative Strength Index measures the speed and magnitude of recent price changes.
    * **The Signal:** We use the `50-line` as our bull/bear territory. An RSI value above 50 indicates that the market's strength is in the hands of the bulls; below 50, it belongs to the bears.

3.  **Stochastics (14, 3): The "Price Speed"**
    * **What it is:** The Stochastic Oscillator (`StochasticFull` in thinkScript) compares a stock's closing price to its price range over a given period. It's a "speed" indicator that is very responsive.
    * **The Signal:** We also use the `50-line` here. A Stochastics value (`FullK`) above 50 confirms that the immediate closing price is in the upper half of its recent range, showing bullish "speed."

### 3. The thinkScript Study: What It Does

To make this strategy actionable, weâ€™ve developed this custom `study` for the ThinkOrSwim (TOS) platform. When you add this study to your chart, it does the heavy lifting for you by:

1.  **Bar Coloring (`AssignPriceColor`):** The script monitors all three indicators on every bar.
    * **Dark Green:** All three factors (MACD, RSI, Stochastics) are bullish.
    * **Dark Red:** All three factors are bearish.
    * **Gray:** The indicators are in conflict (e.g., MACD is bullish, but RSI is bearish). This is the "noise" you should ignore.

2.  **Entry Arrows (`plot`):** To pinpoint the *start* of a new confluence signal, the script plots a **Green (Up) arrow** on the first bullish bar and a **Red (Down) arrow** on the first bearish bar.

{% include figure.html mermaid_code='graph TD
classDef c-start fill:#E0F7FA, stroke:#00BCD4, stroke-width:3px, color:#212121, font-weight:bold;
classDef c-process fill:#E3F2FD, stroke:#2196F3, stroke-width:2px, color:#212121;
classDef c-decision fill:#FFFDE7, stroke:#FFC107, stroke-width:2px, color:#212121;
classDef c-end fill:#F3E5F5, stroke:#9C27B0, stroke-width:3px, color:#212121, font-weight:bold;

    A["fa:fa-cogs Start: Check 3 Factors"]:::c-start
    B{"MACD, RSI, and Stochastics all Bullish?"}:::c-decision
    C["fa:fa-paint-brush Color Bar DARK_GREEN"]:::c-process
    D{"MACD, RSI, and Stochastics all Bearish?"}:::c-decision
    E["fa:fa-paint-brush Color Bar DARK_RED"]:::c-process
    F["fa:fa-paint-brush Color Bar GRAY (Noise)"]:::c-process
    G["fa:fa-check-circle Signal Identified"]:::c-end

    A -- "On Every Bar" --> B
    B -- "Yes" --> C
    B -- "No" --> D
    D -- "Yes" --> E
    D -- "No" --> F
    C --> G
    E --> G
    F --> G
' caption='Visual logic for the thinkScript bar coloring study.' %}

```thinkScript
# Momentum_Confluence_3Factor_TOS.ts
# Developed by: Dr. Kahveci
# Date: 11/7/2025
#
# This study colors the price bars based on a 3-Factor Confluence
# and plots entry arrows when all three factors align.
#
# This is the "Pure Momentum" version intended for lower-timeframe
# entries, to be filtered by a higher-timeframe trend (e.g., 200 EMA).
#
# Factors:
# 1. MACD (Line > Signal)
# 2. RSI (Value > 50)
# 3. Stochastics (%K > 50)
#
# UPDATE: Changed bar colors to DARK_GREEN and DARK_RED for a duller,
# easier-to-read chart.

declare upper; # Plots on the main price chart

# === INPUTS: 3-FACTOR CONFLUENCE ===
input macdFast = 12;
input macdSlow = 26;
input macdSignal = 9;
input rsiLength = 14;
input rsiMidline = 50; # Using 50 as the bull/bear line
input stochK = 14;
input stochD = 3; # %D smoothing
input stochMidline = 50; # Using 50 as the bull/bear line

# === CALCULATIONS ===

# 1. MACD (Momentum Direction)
# Correct param names: fastLength, slowLength, MACDLength
def macdValue = MACD(fastLength = macdFast, slowLength = macdSlow, MACDLength = macdSignal).Value;
def macdAvg   = MACD(fastLength = macdFast, slowLength = macdSlow, MACDLength = macdSignal).Avg;

# 2. RSI (Momentum Strength)
#    FIX: Added .RSI to get the numerical value, not the plot object
def rsiVal = RSI(length = rsiLength).RSI;

# 3. Stochastics (Speed of Price)
def stochKVal = StochasticFull(KPeriod = stochK, DPeriod = stochD).FullK;

# === LOGIC (3 Confluence Factors) ===
def macdBullish = macdValue > macdAvg;
def macdBearish = macdValue < macdAvg;
def rsiBullish = rsiVal > rsiMidline;
def rsiBearish = rsiVal < rsiMidline;
def stochBullish = stochKVal > stochMidline;
def stochBearish = stochKVal < stochMidline;

# === CONFLUENCE ===
def strongBullish = macdBullish and rsiBullish and stochBullish;
def strongBearish = macdBearish and rsiBearish and stochBearish;

# === BAR COLORING ===
AssignPriceColor(
    if strongBullish then Color.DARK_GREEN  # Changed from UPTICK
    else if strongBearish then Color.DARK_RED  # Changed from DOWNTICK
    else Color.GRAY
);

# === ENTRY ARROWS ===
def longEntry = strongBullish and !strongBullish[1];
def shortEntry = strongBearish and !strongBearish[1];

plot LongSignal = if longEntry then low else Double.NaN;
LongSignal.SetPaintingStrategy(PaintingStrategy.ARROW_UP);
LongSignal.SetDefaultColor(Color.GREEN); # Kept arrows bright for visibility
LongSignal.SetLineWeight(2);

plot ShortSignal = if shortEntry then high else Double.NaN;
ShortSignal.SetPaintingStrategy(PaintingStrategy.ARROW_DOWN);
ShortSignal.SetDefaultColor(Color.RED); # Kept arrows bright for visibility
ShortSignal.SetLineWeight(2);
```

### 4. Strategy Execution: A Multi-Timeframe Plan

This thinkScript study is a *signal generator*, not a complete automated system. It is designed to be your entry tool, but it **must** be filtered by a higher-timeframe trend. Using it "naked" on a 5-minute chart will result in many false signals during a pullback.

Here is the professional way to execute this strategy:

**Step 1: Define Your Master Trend (Daily or 4-Hour Chart)**
* Add a 200-period EMA (a standard TOS study) to your *daily* chart.
* Is the price **above** the 200 EMA? Your bias for the day is **LONG ONLY**.
* Is the price **below** the 200 EMA? Your bias for the day is **SHORT ONLY**.

**Step 2: Hunt for Your Entry (5-min or 15-min Chart)**
* Add this **3-Factor Momentum Confluence** study to your lower-timeframe chart.
* Wait for the market to pull back *against* your master trend. This will show as gray or even opposite-colored bars.

**Step 3: Execute the Trade**
* **If your bias is LONG:** Wait for the *first* **Dark Green** bar (and/or Green Arrow) to appear on your 5-min chart. This is your signal that the pullback is over and all three momentum factors have re-aligned with the master trend.
* **If your bias is SHORT:** Wait for the *first* **Dark Red** bar (and/or Red Arrow) to appear on your 5-min chart. This confirms the pullback (the rally) has failed and the downtrend is resuming.

{% include figure.html mermaid_code='graph TD
classDef c-start fill:#E0F7FA, stroke:#00BCD4, stroke-width:3px, color:#212121, font-weight:bold;
classDef c-process fill:#E3F2FD, stroke:#2196F3, stroke-width:2px, color:#212121;
classDef c-decision fill:#FFFDE7, stroke:#FFC107, stroke-width:2px, color:#212121;
classDef c-end fill:#F3E5F5, stroke:#9C27B0, stroke-width:3px, color:#212121, font-weight:bold;

    A["fa:fa-sitemap Start: Analyze Market"]:::c-start
    
    subgraph "Step 1: Define Master Trend (Daily Chart)"
        B["fa:fa-chart-line Check Price vs. 200 EMA"]:::c-process
        C{"Price > 200 EMA?"}:::c-decision
        D["Set Bias: LONG ONLY"]:::c-process
        E["Set Bias: SHORT ONLY"]:::c-process
    end
    
    subgraph "Step 2: Hunt for Entry (5-min Chart)"
        F["fa:fa-search Monitor for Pullback (Gray Bars)"]:::c-process
    end
    
    subgraph "Step 3: Execute Trade"
        G{"Bias is LONG?"}:::c-decision
        H["fa:fa-arrow-up Wait for First DARK_GREEN Bar"]:::c-process
        I["fa:fa-rocket Execute LONG Trade"]:::c-end
        J["fa:fa-arrow-down Wait for First DARK_RED Bar"]:::c-process
        K["fa:fa-anchor Execute SHORT Trade"]:::c-end
    end
    
    A --> B
    B --> C
    C -- "Yes" --> D
    C -- "No" --> E
    D --> F
    E --> F
    F -- "Pullback Occurs" --> G
    G -- "Yes (Bias is Long)" --> H
    G -- "No (Bias is Short)" --> J
    H --> I
    J --> K
' caption='Flowchart of the multi-timeframe execution strategy.' %}

### 5. Case Study: Backtest Results on $BMNR

This execution plan is not just a theory; it's the direct result of rigorous backtesting. We tested this 3-factor confluence strategy (using its Pine Script version) on TradingView over a two-month period for the stock BMNR.

The results were a perfect lesson in why the master trend filter is mandatory:

* **Overall Loss:** Running the strategy "naked" (trading both longs and shorts) resulted in a net loss of **-$130.91**.
* **The Hidden Data:** When we analyzed the performance, we saw a clear split:
    * **Long Trades:** Lost **-$203.41**.
    * **Short Trades:** Made **+$72.50**.
* **The "Why":** The short trades were profitable because, during the test period, BMNR was in a powerful *daily downtrend*. The strategy's long signals were trying to "fight the trend" and were failing. The short signals, however, were perfectly aligned with the master trend and captured the real profits.
* **Conclusion:** The backtest proved that the 3-factor signal *works*, but only when it aligns with the higher-timeframe trend. By "turning off" the long trades (which you would do manually based on your 200 EMA analysis), the strategy flipped from a losing system to a profitable one.

### 6. Underlying Assumptions
* **This is a Momentum, Not a Trend Strategy:** Our thinkScript study identifies *bursts* of momentum. The 200 EMA (or another tool) must be used to tell you which direction to trade.
* **Settings are Not Universal:** The default settings (12, 26, 9, 14, 14, 3) are standard but not magic. They should be tested and optimized for the asset you are trading (e.g., Forex vs. Futures vs. Stocks may behave differently).
* **Risk Management is Separate:** This script does not manage your trade. You must use your own rules for stop-loss placement and profit-taking.

