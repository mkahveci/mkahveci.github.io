<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>{{ page.title }}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

	{% comment %} UPDATED: Added Lato font for Jekyllrb.com consistency {% endcomment %}
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,700;0,900;1,300;1,700;1,900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">

	<script>
		(function() {
           const THEME_STORAGE_KEY = 'kahveci-pw-theme';

           function getPreferredTheme() {
             const storedTheme = localStorage.getItem(THEME_STORAGE_KEY);
             if (storedTheme) {
               return storedTheme;
             }
             // Check OS preference
             return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
           }

           // Set the theme on the <html> element immediately
           const theme = getPreferredTheme();
           document.documentElement.setAttribute('data-bs-theme', theme);
         })();
	</script>
	<link href="{{ site.baseurl }}/css/style.css" rel="stylesheet" media="screen">

	<script>
		MathJax = {
              tex: {
                // ONLY use \\(...\\) for inline math
                inlineMath: [['\\(', '\\)']],
                // Use $$...$$ and \\[...\\] for display math
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
              },
              options: {
                // The ignoreHtmlClass and processHtmlClass lines are technically correct,
                // but often omitted if not specifically needed. Keeping them for safety.
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
              }
            };
	</script>
	<script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

	{% include analytics.html %}
	<link rel="stylesheet" href="{{ '/css/print.css' | relative_url }}" media="print">
	<link rel="icon" href="{{ '/images/logo.svg' | relative_url }}" type="image/svg+xml">

	<link rel="icon" type="image/png" sizes="32x32" href="{{ '/images/logo-32x32.png' | relative_url }}">
	<link rel="icon" type="image/png" sizes="16x16" href="{{ '/images/logo-16x16.png' | relative_url }}">

	<link rel="apple-touch-icon" sizes="180x180" href="{{ '/images/apple-touch-icon.png' | relative_url }}">
</head>
<body>

<header id="header">
	<nav class="navbar navbar-expand-md navbar-light bg-navbar">
		<div class="container">
			{% if page.categories.first != 'home' %}
			<a class="navbar-brand d-flex align-items-center" href="/">
				<img class="logo navbar-brand d-inline-block align-top me-1" src="/images/logo.svg" alt="Logo" style="max-width: 75px; height: auto; border-radius: 50%;">
			</a>
			{% else %}
			<a class="navbar-brand" href="/"></a>
			{% endif %}

			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav nav-pills ms-auto">
					<li class="nav-item">
						{% comment %} Use category OR url match for robustness {% endcomment %}
						<a class="nav-link
                      {% if page.categories.first == 'papers' or page.url == '/publications/' %}active{% endif %}"
						   href="/publications/">publications</a>
					</li>
					<li class="nav-item">
						<a class="nav-link
                      {% if page.categories.first == 'projects' or page.url == '/projects/' %}active{% endif %}"
						   href="/projects/">projects</a>
					</li>
					<li class="nav-item">
						<a class="nav-link
                      {% if page.categories.first == 'courses' or page.url == '/courses/' %}active{% endif %}"
						   href="/courses/">teaching</a>
					</li>

					{% comment %} --- NEWS LINK HAS BEEN REMOVED FROM PRIMARY NAVIGATION --- {% endcomment %}

					<li class="nav-item">
						<a class="nav-link
                      {% if page.categories.first == 'team' or page.url == '/team/' %}active{% endif %}"
						   href="/team/">team</a>
					</li>
					<li class="nav-item">
						<a class="nav-link
                      {% if page.categories.first == 'blog' or page.url == '/blog/' %}active{% endif %}"
						   href="/blog/">blog</a>
					</li>

					<li class="nav-item ms-md-2">
						<button class="nav-link" id="theme-toggler" type="button" aria-label="Toggle theme">
							<i class="fa-solid fa-sun d-none"></i>
							<i class="fa-solid fa-moon d-none"></i>
						</button>
					</li>
				</ul>
			</div>
		</div>
	</nav>
</header>


<main class="container my-5">
	{% if page.wip %}
	{% include wip-alert.html %}
	{% endif %}

	{% if page.related_project %}
	{% include project-callout.html project=page.related_project %}
	{% endif %}

	{{ content }}
</main>

<button id="scrollToTopBtn" class="btn btn-primary rounded-circle shadow-lg" title="Go to top">
	<i class="fa-solid fa-arrow-up"></i>
</button>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script src="/js/copy-code.js"></script>

<script>
	'use strict';

    // ... (all your other script code like copyBibtex) ...

    // ==========================================================
    // 2. DOM UTILITIES (Wrapped in DOMContentLoaded)
    // ==========================================================
    document.addEventListener('DOMContentLoaded', () => {

        // ... (your other init code for current-year and scrollToTopBtn) ...

        // --- Theme Toggler Initialization ---
        const themeToggler = document.getElementById('theme-toggler');
        if (themeToggler) {
            initThemeToggler(themeToggler);
        }
    });

    // ==========================================================
    // 3. UTILITY FUNCTIONS
    // ==========================================================

    // ... (your initScrollToTop function) ...

    // --- REPLACED: Corrected Theme Toggler Logic ---
    function initThemeToggler(button) {
        const THEME_STORAGE_KEY = 'kahveci-pw-theme';
        const sunIcon = button.querySelector('.fa-sun');
        const moonIcon = button.querySelector('.fa-moon');

        // 1. Set the initial icon state on load
        // (This reads the theme set by the script in the <head>)
        const currentTheme = document.documentElement.getAttribute('data-bs-theme');

        // --- THIS LOGIC IS NOW CORRECTED ---
        // Show SUN icon if theme is DARK
        // Show MOON icon if theme is LIGHT
        sunIcon.classList.toggle('d-none', currentTheme === 'light');
        moonIcon.classList.toggle('d-none', currentTheme === 'dark');

        // 2. Add the click listener to toggle the theme
        button.addEventListener('click', () => {
            // Get the *new* theme by flipping the current one
            const newTheme = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';

            // Save and apply the new theme
            localStorage.setItem(THEME_STORAGE_KEY, newTheme);
            document.documentElement.setAttribute('data-bs-theme', newTheme);

            // Update the icon
            // Show SUN icon if new theme is DARK
            // Show MOON icon if new theme is LIGHT
            sunIcon.classList.toggle('d-none', newTheme === 'light');
            moonIcon.classList.toggle('d-none', newTheme === 'dark');
        });
    }
    // --- END REPLACEMENT ---

</script>

{% if page.mermaid %}
<script src="{{ '/assets/js/mermaid.min.js' | relative_url }}"></script>
<script>
    const isDarkMode = document.documentElement.getAttribute('data-bs-theme') === 'dark';

    mermaid.initialize({
      startOnLoad: true,
      theme: isDarkMode ? 'dark' : 'default',
      securityLevel: 'loose',

      flowchart: {
        htmlLabels: true,  // âœ… REQUIRED to allow FontAwesome & HTML labels
        useMaxWidth: false
      },

      themeVariables: isDarkMode ? {
        lineColor: '#EEEEEE',
        textColor: '#EEEEEE',
        mainBkg: '#2a2a2a',
        nodeBorder: '#999999'
      } : {}
    });
</script>
{% endif %}


{% if page.toc %}
<script src="{{ "/assets/js/toc.js" | relative_url }}"></script>
{% endif %}

</body>
</html>