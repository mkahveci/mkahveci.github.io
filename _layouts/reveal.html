<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>{{ page.title | default: "Presentation" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="shortcut icon" href="{{ '/images/favicon.svg' | relative_url }}"/>

    <link rel="stylesheet" href="{{ '/assets/reveal.js/dist/reveal.css' | relative_url }}">

    <link rel="stylesheet" href="{{ '/assets/reveal.js/dist/theme/kahveci.css' | relative_url }}" id="theme">
    <link rel="stylesheet" href="{{ '/assets/reveal.js/dist/reveal-custom.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/reveal.js/dist/reveal-dynamic.css' | relative_url }}">

    <link rel="stylesheet" href="{{ '/assets/reveal.js/plugin/highlight/monokai.css' | relative_url }}">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    {% include analytics.html %}

</head>
<body>

<div class="reveal">
    <div class="slides">
        <section data-markdown data-separator="^\n---\n$" data-separator-vertical="^\n--\n$">
            <script type="text/template">
                {{ content }}
            </script>
        </section>
    </div>
</div>

<div id="qr-code" style="position: absolute; bottom: 20px; left: 20px; z-index: 999; background: white; padding: 5px; border-radius: 5px;"></div>

<script src="{{ '/assets/reveal.js/dist/reveal.js' | relative_url }}"></script>

<script src="{{ '/assets/reveal.js/plugin/markdown/markdown.js' | relative_url }}"></script>
<script src="{{ '/assets/reveal.js/plugin/notes/notes.js' | relative_url }}"></script>
<script src="{{ '/assets/reveal.js/plugin/highlight/highlight.js' | relative_url }}"></script>
<script src="{{ '/assets/reveal.js/plugin/math/math.js' | relative_url }}"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<script>
    function updateQrCode() {
        setTimeout(function() {
            let slideUrl = window.location.href;
            let qrContainer = document.getElementById('qr-code');

            if (qrContainer) {
                qrContainer.innerHTML = '';
                new QRCode(qrContainer, {
                    text: slideUrl,
                    width: 80,
                    height: 80
                });
            }
        }, 100);
    }

    window.onload = function() {
        Reveal.initialize({
            hash: true,
            slideNumber: 'c/t',
            progress: true,
            transition: 'fade',
            backgroundTransition: 'fade',
            controls: true,
            mouseWheel: true,
            loop: false,
            embedded: false,
            center: true,
            plugins: [
                RevealMarkdown,
                RevealHighlight,
                RevealNotes,
                RevealMath.MathJax3
            ],
            mathjax3: {
                mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']]
                },
                options: {
                    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                }
            }
        });

        Reveal.addEventListener('slidechanged', event => {
            updateQrCode();

            if (event.indexh === Reveal.getHorizontalSlides().length - 1) {
                let duration = 180;
                let display = document.querySelector('#countdown');

                if (window.timerInterval) {
                    clearInterval(window.timerInterval);
                }

                let timer = duration;
                window.timerInterval = setInterval(function() {
                    let minutes = parseInt(timer / 60, 10);
                    let seconds = parseInt(timer % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    if (display) {
                        display.textContent = minutes + ":" + seconds;
                    }

                    if (--timer < 0) {
                        timer = 0;
                        clearInterval(window.timerInterval);
                    }
                }, 1000);
            }
        });

        updateQrCode();
    };
</script>

</body>
</html>